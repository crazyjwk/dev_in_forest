<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">

<title>타이틀 제목</title>

<!-- Custom fonts for this template-->
<link th:href="@{/vendor/fontawesome-free/css/all.min.css}"
	rel="stylesheet" type="text/css">
<link
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
	rel="stylesheet">

<!-- Custom styles for this template-->
<link th:href="@{/css/sb-admin-2.min.css}" rel="stylesheet">

<!--  addAdmin template -->
<link th:href="@{/css/addAdmin.css}" rel="stylesheet">
<!-- fontawesome -->
<script src="https://kit.fontawesome.com/yourcode.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- 마크다운 에디터 CDN -->
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" />
<script
	src="https://uicdn.toast.com/editor-plugin-code-syntax-highlight/latest/toastui-editor-plugin-code-syntax-highlight-all.min.js"></script>
<!-- 마크다운 에디터 CDN 끝 -->
<style>
#answer-flex-container {
	display: flex;
	flex-direction: row;
}

.tagBtn {
	background-color: #e1ecf4;
	color: #648ba7;
	border-color: transparent;
	padding: 0;
	width: 50px;
	height: 25px;
	border: 0;
}

.tagBtn:hover {
	background-color: #96bfe4;
	color: #3b7aa0;
	border-color: transparent;
}
</style>
<script>
		$(document).ready(function(){
			let memberName = $('#memberName').val();
			let questionNo = $('#questionNo').val();
			let commentIp = $('#commentIp').val();
			let answerContent = $('#addAnswerContent').val();
			let questionContent = $('#questionContent').val();
			let showMore = true;
			let commentSwitch = true;
			
			
			console.log(questionContent);
			console.log(memberName);
			console.log(questionNo);
			console.log(commentIp);
			console.log(answerContent);
			
			const Viewer = toastui.Editor;
			const { codeSyntaxHighlight } = Viewer.plugin;
			const viewer = new Viewer({
				  el: document.querySelector('#viewer'),
				  height: 'auto',
				  initialValue: questionContent,
				  plugins: [codeSyntaxHighlight]
			});
			
		
			// 질문 총 투표 수 가져오기
			$.ajax({
				url: '/voteTotalCount',
				type: 'GET',
				data: {'questionNo' : questionNo},
				success : function(data) {
					$('#count').remove();
					$('#voteTotalCount').append('<div id="count">'+ data +'</div>');
					$.ajax({
						url: '/voteCheck',
						type: 'GET',
						data: {'memberName' : memberName, 'questionNo' : questionNo},
						success: function(data) {
							if(data['memberName'] != null && data['votePoint'] == 1) {
								$('#fa-chevron-up').css('color', 'green');
								$('#downBtn').attr("disabled", true);
								return false;
							} else if(data['memberName'] != null && data['votePoint'] == 0) {
								$('#fa-chevron-down').css('color', '#a40000');
								$('#upBtn').attr("disabled", true);
								return false;
							}
						}
					});
				}
			});
			
			/* *****************************  질문 관련 AJAX  ****************************** */	
			
			// 질문 댓글 가져오기
			$.ajax({
				url: '/getQuestionCommentList',
				type: 'GET',
				data: {'questionNo' : questionNo},
				success: function(data) {
						$(data).each(function(index, item){
							$('#questionCommentList').append('<div style="display:flex; justify-content:space-between">' +
																'<div>' + item.questionCommentContent +'</div>' +
																'<div> by ' + item.memberName + '(' + item.questionCommentIp.substring(0, 7) + ')</div>' +
															'</div>');
							
							console.log($(data).length + "<--- QuestionCommentList");
						});
						if($(data).length >= 5) {
							$('#questionCommentShowMore').append('<a id="questionCommentChangeRowPerPage" href="#">show more comment</a>');
						}
						$('#questionCommentChangeRowPerPage').click(function(){
							console.log("questionCommentChangeRowPerPage click");
							$.ajax({
								url: '/getQuestionCommentList',
								type: 'GET',
								data: {'questionNo' : questionNo, 'showMore' : showMore},
								success : function(data) {
									$(data).each(function(index, item){
										$('#questionCommentList').empty();
										$('#questionCommentAllList').append('<div style="display:flex; justify-content:space-between">' +
																				'<div>' + item.questionCommentContent +'</div>' +
																				'<div> by ' + item.memberName + '(' + item.questionCommentIp.substring(0, 7) + ')</div>' +
																			'</div>');
										$('#questionCommentChangeRowPerPage').empty();
										
										console.log($(data).length + "<--- QuestionCommentList");
									});
									console.log("변경성공");
								}
							});
						});	
					}
			});
			
			// 질문 댓글 작성
			$('#writeQuestionCommentBtn').click(function() {
				$('#writeQuestionCommentBtn').empty();
				$('#questionComment').append('<br><div style="width:400px;" class="input-group mb-3"><input class="form-control" type="text" id="questionCommentContent"></input><div class="input-group-append"><button class="btn btn-outline-success btn-sm" type="button" id="writeBtn">작성</button></div></div>');
				
				$('#writeBtn').click(function() {
					console.log("writeBtn click");
					
					let questionCommentContent = $('#questionCommentContent').val();

					$.ajax({
						url: '/addQuestionComment',
						type: 'POST',
						data: {'questionNo' : questionNo, 'memberName' : memberName, 'questionCommentContent' : questionCommentContent, 'questionCommentIp' : commentIp},
						success : function() {
							$('#questionCommentContent').remove();
							$('#writeBtn').remove();
							$('#questionCommentAllList').empty();
							$('#writeQuestionCommentBtn').html('<a btn-sm" id="writeQuestionCommentBtn" href="#">댓글 작성</a>');
							console.log("질문 댓글 작성 성공");
							let memberReputation = 5;
							$.ajax({
								url: '/modifyMemberReputation',
								type: 'POST',
								data: {'memberName' : memberName, 'memberReputation' : memberReputation},
								success: function() {
									console.log("내공 갱신 성공");
								}
							});
							$.ajax({
								url: '/getQuestionCommentList',
								type: 'GET',
								data: {'questionNo' : questionNo},
								success : function(data) {
									$(data).each(function(index, item){
										$('#questionCommentList').empty();
										$('#questionCommentAllList').append('<div style="display:flex; justify-content:space-between">' +
																				'<div>' + item.questionCommentContent +'</div>' +
																				'<div> by ' + item.memberName + '(' + item.questionCommentIp.substring(0, 7) + ')</div>' +
																			'</div>');
										$('#questionCommentAllList').append('</tr>');
										
										console.log($(data).length + "<--- QuestionCommentList");
									});
									if($(data).length >= 5) {
										$('#questionCommentShowMore').empty();
										$('#questionCommentShowMore2').html('<a id="questionCommentChangeRowPerPage2" href="#">show more comment</a>');
									}
									$('#questionCommentChangeRowPerPage2').click(function(){
										console.log("questionCommentChangeRowPerPage2 click");
										$.ajax({
											url: '/getQuestionCommentList',
											type: 'GET',
											data: {'questionNo' : questionNo, 'showMore' : showMore},
											success : function(data) {
												$(data).each(function(index, item){
													$('#questionCommentAllList').empty();
													$('#questionCommentList').append('<div style="display:flex; justify-content:space-between">' +
																						 '<div>' + item.questionCommentContent +'</div>' +
																						 '<div> by ' + item.memberName + '(' + item.questionCommentIp.substring(0, 7) + ')</div>' +
																					 '</div>');
													$('#questionCommentChangeRowPerPage').empty();
													console.log($(data).length + "<--- QuestionCommentList");
												});
													$('#questionCommentChangeRowPerPage2').empty();
													console.log("변경성공2");
											}
										});
									});
								}
							});
						}
					});
				});
			});
			
			/* *****************************  투표 관련 AJAX  ****************************** */	
			
			// 질문 up 버튼
			$('#upBtn').click(function(){
				if(memberName == "Guest") {
					alert("Geust는 투표를 할 수 없습니다.");
					return;
				}
				
				$.ajax({
					url:'/voteCheck',
					type: 'GET',
					data: {'memberName' : memberName, 'questionNo' : questionNo},
					success: function(data) {
						console.log(data);
						if(data['memberName'] == null) {
							$.ajax({
								url: '/plusVote',
								type: 'GET',
								data: {'memberName' : memberName, 'questionNo' : questionNo},
								success : function(data) {
									$('#count').remove();
									$('#voteTotalCount').append('<div id="count">' + data + '</div>');
					                console.log("좋아요 성공");
					                $('#fa-chevron-up').css('color', 'green');
					                $('#downBtn').attr("disabled", true);
					                return false;
								}
							});
						} else {
							if (confirm("추천을 취소하시겠습니까?") == true){    //확인
								$('#fa-chevron-up').css('color', '#858796');
							}else{   //취소
							    return;
							}
							$.ajax({
								url: '/deleteVote',
								type: 'GET',
								data: {'memberName' : memberName, 'questionNo' : questionNo},
								success : function(data) {
									$('#count').remove();
									$('#voteTotalCount').append('<div id="count">' + data + '</div>');
									
									$('#downBtn').attr("disabled", false);
									console.log("삭제 성공");	
								
								}
							});
							
						}
					}
				});
			});
			
			// 질문 down 버튼
			$('#downBtn').click(function(){
				if(memberName == "Guest") {
					alert("Geust는 투표를 할 수 없습니다.");
					return;
				}
				$.ajax({
					url:'/voteCheck',
					type: 'GET',
					data: {'memberName' : memberName, 'questionNo' : questionNo},
					success: function(data) {
						if(data['memberName'] == null) {
							$.ajax({
								url: '/minusVote',
								type: 'GET',
								data: {'memberName' : memberName, 'questionNo' : questionNo},
								success : function(data) {
									$('#count').remove();
									$('#voteTotalCount').append('<div id="count">' + data + '</div>');
									$('#fa-chevron-down').css('color', '#a40000');
									$('#upBtn').attr("disabled", true);
									console.log("싫어요 성공");
					                return false;
								}
							});
						} else {
							if (confirm("비추천을 취소하시겠습니까?") == true){    //확인
								$('#fa-chevron-down').css('color', '#858796');
							}else{   //취소
							    return;
							}
							$.ajax({
								url: '/deleteVote',
								type: 'GET',
								data: {'memberName' : memberName, 'questionNo' : questionNo},
								success : function(data) {
									$('#count').remove();
									$('#voteTotalCount').append('<div id="count">' + data + '</div>');
									$('#upBtn').attr("disabled", false);
									console.log("삭제 성공");	
					            	
								}
							});
							
						} 
					}
				});
			});
			
			/* *****************************  답변 관련 AJAX  ****************************** */	
			// 답변 리스트, 댓글 리스트 가져오기
			$.ajax({
				url: '/getAnswerList',
				type: 'GET',
				data: {'questionNo' : questionNo},
				success : function(data) {
					console.log(data['answerList']);
					console.log(data['lastPage']);
					$('#answerTotalCount').text(data['answerTotalCount'] + ' 답변');
					console.log(memberName + "<-- AnswerList memberName");
					$.each(data['answerList'], function(index, item){
						$.ajax({
							url:'/answerVoteTotalCount',
							type: 'GET',
							data: {'answerNo' : item.answerNo},
							success: function(data) {
								$('#answerCount'+ item.answerNo).remove();
								$('#answerVoteTotalCount'+ item.answerNo).append('<div id="answerCount'+ item.answerNo+'">' + data + '</div>');
								$.ajax({
									url: '/answerVoteCheck',
									type: 'GET',
									data: {'memberName' : memberName, 'answerNo' : item.answerNo},
									success: function(data) {
										if(data['memberName'] != null && data['votePoint'] == 1) {
											$('#fa-chevron-up'+ item.answerNo).css('color', 'green');
											$('#answerDownBtn'+ item.answerNo).attr("disabled", true);
											return false;
										} else if(data['memberName'] != null && data['votePoint'] == 0) {
											$('#fa-chevron-down'+ item.answerNo).css('color', '#a40000');
											$('#answerUpBtn'+ item.answerNo).attr("disabled", true);
											return false;
										}
									}
								});
							}
						});
					});
					$.each(data['answerList'], function(index, item){
						$('#answerList').append('<div id="answer-flex-container">' +
													'<table>' +
														'<tr>' +
	 														'<td><button class="btn" type="button" id="answerUpBtn' + item.answerNo +'"><i id="fa-chevron-up'+ item.answerNo +'" class="fas fa-chevron-up" style="font-size:24px"></i></button></td>' +
	 													'</tr>' +
	 													'<tr>' +
	 														'<td style="text-align:center; font-size:20px; font-weight:bold;" ><div id="answerVoteTotalCount' +item.answerNo +'"></div></td>' +
	 													'</tr>' +
	 													'<tr>' +
	 														'<td><button class="btn" type="button" id="answerDownBtn' + item.answerNo +'"><i id="fa-chevron-down'+ item.answerNo +'" class="fas fa-chevron-down" style="font-size:24px"></i></button></td>' +
	 													'</tr>' +
	 												'</table>' +
	 												'<div id="viewer' + item.answerNo + '" style="font-size: 18px;"></div>' +
	 											'</div>');
						$('#answerList').append('<div style="text-align: right;">by ' + item.memberName  + '(' + item.answerIp.substring(0, 7) + ')</div>');
						$('#answerList').append('<div><button type="button" class="btn btn-outline-danger btn-sm" id="answerSelectBtn'+ item.answerNo +'">신고</button></div><br>');
						$('#answerList').append('<div id="answerCommentList'+ item.answerNo +'">');
						$('#answerList').append('<div id="answerCommentShowMore' + item.answerNo + '"></div>');
						$('#answerList').append('</div>');
						$('#answerList').append('<div id="answerCommentAllList' + item.answerNo + '">');
						$('#answerList').append('<div id="answerCommentShowMoreAll' + item.answerNo + '"></div>');
						$('#answerList').append('</div>');
						$('#answerList').append('<br><div id="answerComment'+item.answerNo +'"><a id="writeAnswerCommentBtn' + item.answerNo + '" href="#">댓글 작성</a></div>');					
						$('#answerList').append('<hr>');
						
						const viewer = new Viewer({
							  el: document.querySelector('#viewer' + item.answerNo),
							  height: 'auto',
							  initialValue: item.answerContent,
							  plugins: [codeSyntaxHighlight]
						});
					});
					
					$.each(data['answerList'], function(index, item){
						$('#answerUpBtn'+item.answerNo).click(function(){
							if(memberName == "Guest") {
								alert("Geust는 투표를 할 수 없습니다.");
								return;
							}
							$.ajax({
								url:'/answerVoteCheck',
								type: 'GET',
								data: {'memberName' : memberName, 'answerNo' : item.answerNo},
								success: function(data) {
									console.log(data);
									if(data['memberName'] == null) {
										$.ajax({
											url: '/plusAnswerVote',
											type: 'GET',
											data: {'memberName' : memberName, 'answerNo' : item.answerNo},
											success : function(data) {
												$('#answerCount'+ item.answerNo).remove();
												$('#answerVoteTotalCount'+ item.answerNo).append('<div id="answerCount'+ item.answerNo+'">' + data + '</div>');
								                console.log("좋아요 성공");
								                $('#fa-chevron-up'+ item.answerNo).css('color', 'green');
								                $('#answerDownBtn'+ item.answerNo).attr("disabled", true);
								                return false;
											}
										});
									} else {
										if (confirm("추천을 취소하시겠습니까?") == true){    //확인
											$('#fa-chevron-up'+ item.answerNo).css('color', '#858796');
										}else{   //취소
										    return;
										}
										$.ajax({
											url: '/deleteAnswerVote',
											type: 'GET',
											data: {'memberName' : memberName, 'answerNo' : item.answerNo},
											success : function(data) {
												$('#answerCount'+ item.answerNo).remove();
												$('#answerVoteTotalCount'+ item.answerNo).append('<div id="answerCount'+ item.answerNo+'">' + data + '</div>');
												$('#answerDownBtn'+ item.answerNo).attr("disabled", false);
												console.log("삭제 성공");	
											
											}
										});
										
									}
								}
							});
						});
						$('#answerDownBtn'+ item.answerNo).click(function(){
							if(memberName == "Guest") {
								alert("Geust는 투표를 할 수 없습니다.");
								return;
							}
							$.ajax({
								url:'/answerVoteCheck',
								type: 'GET',
								data: {'memberName' : memberName, 'answerNo' : item.answerNo},
								success: function(data) {
									if(data['memberName'] == null) {
										$.ajax({
											url: '/minusAnswerVote',
											type: 'GET',
											data: {'memberName' : memberName, 'answerNo' : item.answerNo},
											success : function(data) {
												$('#answerCount'+ item.answerNo).remove();
												$('#answerVoteTotalCount'+ item.answerNo).append('<div id="answerCount'+ item.answerNo+'">' + data + '</div>');
												$('#fa-chevron-down'+ item.answerNo).css('color', '#a40000');
												$('#answerUpBtn'+ item.answerNo).attr("disabled", true);
												console.log("싫어요 성공");
								                return false;
											}
										});
									} else {
										if (confirm("비추천을 취소하시겠습니까?") == true){    //확인
											$('#fa-chevron-down'+ item.answerNo).css('color', '#858796');
										}else{   //취소
										    return;
										}
										$.ajax({
											url: '/deleteAnswerVote',
											type: 'GET',
											data: {'memberName' : memberName, 'answerNo' : item.answerNo},
											success : function(data) {
												$('#answerCount'+ item.answerNo).remove();
												$('#answerVoteTotalCount'+ item.answerNo).append('<div id="answerCount'+ item.answerNo+'">' + data + '</div>');
												$('#answerUpBtn'+ item.answerNo).attr("disabled", false);
												console.log("삭제 성공");	
											}
										});
									} 
								}
							});
						});
					});
					// 답변 채택
					$.each(data['answerList'], function(index, item){
						$('#answerSelectBtn' + item.answerNo).click(function(){
							if(memberName == "Guest") {
								alert("Guest는 신고할 수 없습니다.");
								return;
							} else if(memberName == item.memberName) {
								alert("자기 자신은 신고할 수 없습니다.");
								return;
							}
						});
					});
					// 답변 댓글 목록
					$.each(data['answerList'], function(index, item){
						$.ajax({
							url: '/getAnswerCommentList',
							type: 'GET',
							data: {'answerNo' : item.answerNo},
							success: function(data) {
								console.log($(data).length + "<--- AnswerCommentList");
								$(data).each(function(index, item){
									$('#answerCommentList' + item.answerNo).append('<div style="display:flex; justify-content: space-between;">' +
																						'<div>' + item.answerCommentContent + '</div>' +
																						'<div>by ' + item.memberName + '(' + item.answerCommentIp.substring(0, 7) + ')</div>' +
																				   '</div>');
								});
									if($(data).length >= 5) {
										$('#answerCommentShowMore' + item.answerNo).append('<a id="answerCommentChangeRowPerPage'+ item.answerNo +'" href="#">show more comment</a>');
									}
							
								$('#answerCommentChangeRowPerPage' + item.answerNo).click(function(){
									$.ajax({
										url: '/getAnswerCommentList',
										type: 'GET',
										data: {'answerNo' : item.answerNo, 'showMore' : showMore},
										success : function(data) {
											$(data).each(function(index, item){
												$('#answerCommentList' + item.answerNo).empty();
												$('#answerCommentAllList' + item.answerNo).append('<div style="display:flex; justify-content: space-between;">' +
																										'<div>' + item.answerCommentContent + '</div>' +
																										'<div>by ' + item.memberName + '(' + item.answerCommentIp.substring(0, 7) + ')</div>' +
																								  '</div>');
												$('#answerCommentChangeRowPerPage' + item.answerNo).empty();
												
												console.log($(data).length + "<--- AnswerCommentList");
												
											});
											console.log("answerCommentChangeRowPerPage 변경성공");
											commentSwitch = false;
										}
									});
								});
							} 
						});
					});
					// 답변 댓글 작성
					$.each(data['answerList'], function(index, item){
						$('#writeAnswerCommentBtn'+ item.answerNo).click(function() {
							if(memberName == "Guest") {
								alert("댓글을 작성하려면 로그인을 하세요.");
								location.href='/memberLogin';
								return;
							}
							$('#writeAnswerCommentBtn' + item.answerNo).empty();
							$('#answerComment'+ item.answerNo).empty();
							$('#answerComment'+ item.answerNo).html('<div style="width:400px;" class="input-group mb-3"><input  class="form-control" type="text" id="answerCommentContent'+ item.answerNo +'"></input><div class="input-group-append"><button class="btn btn-outline-success btn-sm" type="button" id="answerWriteBtn' + item.answerNo + '">작성</button></div></div>');
							
							$('#answerWriteBtn' + item.answerNo).click(function() {
								console.log("answerWriteBtn click");
								
								let answerCommentContent = $('#answerCommentContent' + item.answerNo).val();
								$.ajax({
									url: '/addAnswerComment',
									type: 'POST',
									data: {'answerNo' : item.answerNo, 'questionNo' : questionNo, 'memberName' : memberName, 'answerCommentContent' : answerCommentContent, 'answerCommentIp' : commentIp},
									success : function() {
										let memberReputation = 5;
										$.ajax({
											url: '/modifyMemberReputation',
											type: 'POST',
											data: {'memberName' : memberName, 'memberReputation' : memberReputation},
											success: function() {
												console.log("내공 갱신 성공");
											}
										});
										$('#answerCommentContent' + item.answerNo).remove();
										$('#answerWriteBtn' + item.answerNo).remove();
										$('#writeAnswerCommentBtn' + item.answerNo).empty();
										$('#answerComment' + item.answerNo).empty();
										
										console.log("답변 댓글 작성 성공");
										$.ajax({
											url: '/getAnswerCommentList',
											type: 'GET',
											data: {'answerNo' : item.answerNo},
											success: function(data) {
												console.log($(data).length + "<--- AnswerCommentList");
												console.log(commentSwitch + "<----- commentSwitch");
												if(commentSwitch == false) {
													$(data).each(function(index, item){
														$('#answerCommentAllList' + item.answerNo).empty();
														$('#answerCommentList' + item.answerNo).append('<div style="display:flex; justify-content: space-between;">' +
																											'<div>' + item.answerCommentContent + '</div>' +
																											'<div>by ' + item.memberName + '(' + item.answerCommentIp.substring(0, 7) + ')</div>' +
																									   '</div>');
														$('#answerComment' + item.answerNo).html('<br><a id="writeAnswerCommentBtn' + item.answerNo + '" href="#">댓글 작성</a>');
													});
													if($(data).length >= 5) {
														$('#answerCommentShowMore' + item.answerNo).empty();
														$('#answerCommentShowMoreAll' + item.answerNo).html('<a id="answerCommentChangeRowPerPage2'+ item.answerNo +'" href="#">show more comment</a>');
													}
													$('#answerCommentChangeRowPerPage2' + item.answerNo).click(function(){
														$.ajax({
															url: '/getAnswerCommentList',
															type: 'GET',
															data: {'answerNo' : item.answerNo, 'showMore' : showMore},
															success : function(data) {
																$(data).each(function(index, item){
																	$('#answerCommentList' + item.answerNo).empty();
																	$('#answerCommentAllList' + item.answerNo).append('<div style="display:flex; justify-content: space-between;">' +
																														'<div>' + item.answerCommentContent + '</div>' +
																														'<div>by ' + item.memberName + '(' + item.answerCommentIp.substring(0, 7) + ')</div>' +
																												   '</div>');
																	$('#answerComment' + item.answerNo).html('<br><a id="writeAnswerCommentBtn' + item.answerNo + '" href="#">댓글 작성</a>');
																	$('#answerCommentChangeRowPerPage2' + item.answerNo).empty();
																	
																	console.log($(data).length + "<--- AnswerCommentList");
																	
																});
																console.log("변경성공2222");
															}
														});
													});
												} else {
													$(data).each(function(index, item){
														$('#answerCommentList' + item.answerNo).empty();
														$('#answerCommentAllList' + item.answerNo).append('<div style="display:flex; justify-content: space-between;">' +
																											'<div>' + item.answerCommentContent + '</div>' +
																											'<div>by ' + item.memberName + '(' + item.answerCommentIp.substring(0, 7) + ')</div>' +
																										'</div>');
														$('#answerComment' + item.answerNo).html('<br><a id="writeAnswerCommentBtn' + item.answerNo + '" href="#">댓글 작성</a>');
													});
													if($(data).length >= 5) {
														$('#answerCommentShowMore' + item.answerNo).empty();
														$('#answerCommentShowMoreAll' + item.answerNo).html('<a id="answerCommentChangeRowPerPage'+ item.answerNo +'" href="#">show more comment</a>');
													}
													$('#answerCommentChangeRowPerPage' + item.answerNo).click(function(){
														$.ajax({
															url: '/getAnswerCommentList',
															type: 'GET',
															data: {'answerNo' : item.answerNo, 'showMore' : showMore},
															success : function(data) {
																$(data).each(function(index, item){
																	$('#answerCommentAllList' + item.answerNo).empty();
																	$('#answerCommentList' + item.answerNo).append('<div style="display:flex; justify-content: space-between;">' +
																														  '<div>' + item.answerCommentContent + '</div>' +
																														  '<div>by ' + item.memberName + '(' + item.answerCommentIp.substring(0, 7) + ')</div>' +
																												   	  '</div>');
																	$('#answerComment' + item.answerNo).html('<a id="writeAnswerCommentBtn' + item.answerNo + '" href="#">댓글 작성</a>');
																	$('#answerCommentChangeRowPerPage' + item.answerNo).empty();
																	
																	console.log($(data).length + "<--- AnswerCommentList");
																	
																});
																console.log("변경성공2222");
															}
														});
													});
												}
											}
										});
									}
								});
							});
						});
					});
				}
			});
			// 답변 작성 
			$('#addAnswerBtn').click(function(){
				console.log("addAnswerBtn click");
				let addAnswerContent = $('#addAnswerContent').val();
				console.log($('#addAnswerContent').val());
				$.ajax({
					url: '/addAnswer',
					type: 'POST',
					data: {'memberName' : memberName, 'questionNo' : questionNo, 'answerContent' : addAnswerContent, 'answerIp' : commentIp},
					success : function() {
						let memberReputation = 20;
						$.ajax({
							url: '/modifyMemberReputation',
							type: 'POST',
							data: {'memberName' : memberName, 'memberReputation' : memberReputation},
							success: function() {
								console.log("내공 갱신 성공");
							}
						});
						$.ajax({
							url: '/getAnswerList',
							type: 'GET',
							data: {'questionNo' : questionNo},
							success : function(data) {
								console.log(data['answerList']);
								console.log(data['lastPage']);
				
								location.reload();
							}
						});
					}
				});
			});
		});
	</script>
</head>
<body id="page-top">
	<script
		src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
	<script
		src="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.js"></script>
	<!-- Editor's Plugin -->
	<script
		src="https://uicdn.toast.com/editor-plugin-code-syntax-highlight/latest/toastui-editor-plugin-code-syntax-highlight-all.min.js"></script>
	<!-- Page Wrapper -->
	<div id="wrapper">

		<!-- 사이드바 -->
		<ul
			class="navbar-nav bg-gradient-success sidebar sidebar-dark accordion"
			id="accordionSidebar">

			<!-- Sidebar - Brand -->
			<a
				class="sidebar-brand d-flex align-items-center justify-content-center"
				th:href="@{/home}">
				<div class="sidebar-brand-icon rotate-n-15">
					<i class="fas fa-tree"></i>
				</div>
				<div class="sidebar-brand-text mx-3">Dev In Forest</div>
			</a>

			<!-- Divider -->
			<hr class="sidebar-divider my-0">

			<!-- Nav Item - Dashboard -->
			<li th:if="${accountKind} == 'M'" class="nav-item active"><a
				class="nav-link" th:href="@{/home}"> <i
					class="fas fa-fw fa-tachometer-alt"></i> <span>홈</span></a></li>
			<li th:if="${accountKind} == 'C'" class="nav-item active"><a
				class="nav-link" th:href="@{/companyHome}"> <i
					class="fas fa-fw fa-tachometer-alt"></i> <span>홈</span></a></li>

			<!-- Divider -->
			<hr th:if="${accountKind} == 'M'" class="sidebar-divider">
			<hr th:if="${accountKind} == 'C'" class="sidebar-divider">

			<!-- Heading -->
			<div th:if="${accountKind} == 'M'" class="sidebar-heading">회원</div>
			<div th:if="${accountKind} == 'C'" class="sidebar-heading">기업</div>

			<!-- Nav Item - 일반회원 관리 -->
			<li th:if="${accountKind} == 'M'" class="nav-item"><a
				class="nav-link collapsed" href="#" data-toggle="collapse"
				data-target="#collapse1" aria-expanded="true"
				aria-controls="collapseTwo"> <i class="fas fa-fw fa-cog"></i> <span>일반회원</span>
			</a>
				<div id="collapse1" class="collapse" aria-labelledby="headingTwo"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">일반회원</h6>
						<a class="collapse-item"
							th:href="@{/getMemberInfo(memberEmail=${session.loginMember.memberEmail})}">회원정보</a>
						<a class="collapse-item" th:href="@{/getMemberList}">회원리스트</a> <a
							class="collapse-item" href="#">채용 리스트</a> <a
							class="collapse-item" href="#">면접제의 리스트</a> <a
							class="collapse-item" href="#">문의&신고</a>
					</div>
				</div></li>
			<li th:if="${accountKind} == 'C'" class="nav-item"><a
				class="nav-link collapsed" href="#" data-toggle="collapse"
				data-target="#collapse1" aria-expanded="true"
				aria-controls="collapseTwo"> <i class="fas fa-fw fa-cog"></i> <span>기업회원</span>
			</a>
				<div id="collapse1" class="collapse" aria-labelledby="headingTwo"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">기업회원</h6>
						<a class="collapse-item"
							th:href="@{/getCompanyInfo(companyEmail=${companyEmail})}">회원정보</a>
						<a class="collapse-item" th:href="@{/getMemberListForCompany}">일반회원목록</a>
					</div>
				</div></li>


			<!-- Divider -->
			<hr class="sidebar-divider">

			<!-- Heading -->
			<div th:if="${accountKind} != 'C'" class="sidebar-heading">해시태그</div>


			<!-- Nav Item - Charts -->
			<li th:if="${accountKind} != 'C'" class="nav-item"><a
				class="nav-link" th:href="@{/getHashtagList}"> <i
					class="fas fa-fw fa-folder"></i> <span>해시태그</span>
			</a></li>

			<!-- Divider -->
			<hr th:if="${accountKind} != 'C'" class="sidebar-divider">

			<!-- Heading -->
			<div th:if="${accountKind} != 'C'" class="sidebar-heading">Q&A</div>
			<div th:if="${accountKind} == 'C'" class="sidebar-heading">Q&A</div>

			<!-- 관리자, 일반회원, Guest 전용 -->
			<li th:if="${accountKind} != 'C'" class="nav-item"><a
				class="nav-link collapsed" href="#" data-toggle="collapse"
				data-target="#collapse3" aria-expanded="true"
				aria-controls="collapsePages"> <i class="fas fa-fw fa-folder"></i>
					<span>Q&A</span>
			</a>
				<div id="collapse3" class="collapse" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">Q&A</h6>
						<a class="collapse-item" th:href="@{/getQuestionList}">질문리스트</a> <a
							th:if="${accountKind} == 'M'" class="collapse-item"
							th:href="@{/addQuestion(memberName=${memberName})}">질문하기</a>
					</div>
				</div></li>

			<!-- 기업 페이지 전용 -->
			<li th:if="${accountKind} == 'C'" class="nav-item"><a
				class="nav-link collapsed" href="#" data-toggle="collapse"
				data-target="#collapse3" aria-expanded="true"
				aria-controls="collapsePages"> <i class="fas fa-fw fa-folder"></i>
					<span>Q&A</span>
			</a>
				<div id="collapse3" class="collapse" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">Q&A</h6>
						<a class="collapse-item" th:href="@{/getQuestionList}">질문목록</a>
					</div>
				</div></li>
			<!-- 구분 줄 -->
			<hr class="sidebar-divider">

			<!-- 기업확인 - 사이드바 제목 -->
			<div th:if="${accountKind} == 'M'" class="sidebar-heading">채용</div>
			<div th:if="${accountKind} == 'C'" class="sidebar-heading">채용공고</div>

			<!-- 일반회원 기업 -->
			<li th:if="${accountKind} == 'M'" class="nav-item"><a
				class="nav-link collapsed" href="#" data-toggle="collapse"
				data-target="#collapse5" aria-expanded="true"
				aria-controls="collapsePages"> <i
					class="fas fa-fw fa-chart-area"></i> <span>채용</span>
			</a>
				<div id="collapse5" class="collapse" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">기업</h6>
						<a class="collapse-item" th:href="@{/getCompanyList}">기업정보리스트</a>
						<a class="collapse-item" th:href="@{/getRecruitList}">채용공고</a>
					</div>
				</div></li>

			<!-- 기업 전용 채용공고 -->
			<li th:if="${accountKind} == 'C'" class="nav-item"><a
				class="nav-link collapsed" href="#" data-toggle="collapse"
				data-target="#collapse5" aria-expanded="true"
				aria-controls="collapsePages"> <i
					class="fas fa-fw fa-chart-area"></i> <span>채용공고</span>
			</a>
				<div id="collapse5" class="collapse" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">채용공고</h6>
						<a class="collapse-item"
							th:href="@{/getRecruitListByCompany(searchWord=${memberName})}">기업정보리스트</a>
					</div>
				</div></li>
			<!-- 구분 줄 -->
			<hr th:if="${accountKind} == 'C'" class="sidebar-divider">

			<!-- 면접확인 - 사이드바 제목 -->
			<div th:if="${accountKind} == 'C'" class="sidebar-heading">면접제의</div>

			<!-- 면접 -->
			<li th:if="${accountKind} == 'C'" class="nav-item"><a class="nav-link collapsed" href="#"
				data-toggle="collapse" data-target="#collapse6" aria-expanded="true"
				aria-controls="collapsePages"> <i
					class="fas fa-fw fa-chart-area"></i> <span>면접제의</span>
			</a>
				<div id="collapse6" class="collapse" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<h6 class="collapse-header">면접제의</h6>
						<a class="collapse-item" th:href="@{/getMemberListForCompany}">면접제의
							하기</a> <a class="collapse-item"
							th:href="@{/suggestList(companyName=${memberName})}">면접제의 리스트</a>
					</div>
				</div></li>
			<!-- 면접 끝 -->
			<!-- Divider -->
			<hr class="sidebar-divider d-none d-md-block">
		</ul>
		<!-- 사이드바 끝 -->

		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">

			<!-- Main Content -->
			<div id="content">

				<!-- 상단 바 -->
				<nav
					class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

					<!-- Sidebar Toggle (Topbar) -->
					<button id="sidebarToggleTop"
						class="btn btn-link d-md-none rounded-circle mr-3">
						<i class="fa fa-bars"></i>
					</button>

					<!-- 상단 검색창 -->
					<form
						class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
						<div class="input-group">
							<input type="text" class="form-control bg-light border-0 small"
								placeholder="Search for..." aria-label="Search"
								aria-describedby="basic-addon2">
							<div class="input-group-append">
								<button class="btn btn-success" type="button">
									<i class="fas fa-search fa-sm"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- 상단 검색창 끝 -->

					<!-- Topbar Navbar -->
					<ul class="navbar-nav ml-auto">

						<!-- Nav Item - Search Dropdown (Visible Only XS) -->
						<li class="nav-item dropdown no-arrow d-sm-none"><a
							class="nav-link dropdown-toggle" href="#" id="searchDropdown"
							role="button" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="false"> <i class="fas fa-search fa-fw"></i>
						</a> <!-- Dropdown - Messages -->
							<div
								class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
								aria-labelledby="searchDropdown">
								<form class="form-inline mr-auto w-100 navbar-search">
									<div class="input-group">
										<input type="text"
											class="form-control bg-light border-0 small"
											placeholder="Search for..." aria-label="Search"
											aria-describedby="basic-addon2">
										<div class="input-group-append">
											<button class="btn btn-primary" type="button">
												<i class="fas fa-search fa-sm"></i>
											</button>
										</div>
									</div>
								</form>
							</div></li>

						<!-- 닉네임 나오는 곳 - 상단 바 -->
						<li class="nav-item dropdown no-arrow"><a
							class="nav-link dropdown-toggle" href="#" id="userDropdown"
							role="button" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="false"> <span
								class="mr-2 d-none d-lg-inline text-gray-600 small"
								th:text="${memberName}"></span> <img
								class="img-profile rounded-circle" th:src="@{/img/img.png}">
						</a> <!-- Dropdown - User Information -->
							<div th:if="${memberName} != 'Guest'"
								class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
								aria-labelledby="userDropdown">
								<a class="dropdown-item" href="#" data-toggle="modal"
									data-target="#logoutModal"> <i
									class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
									로그아웃
								</a>
							</div>
							<div th:unless="${memberName} != 'Guest'"
								class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
								aria-labelledby="userDropdown">
								<a class="dropdown-item" href="#" th:href="@{/memberLogin}"
									th:text="로그인"> <i
									class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
								</a>
							</div></li>
						<!-- 닉네임 나오는 곳 - 상단 바 끝-->
					</ul>
				</nav>
				<!-- 상단 바 끝 -->
				<!-- 내용 넣는 곳 -->
				<div class="container pt-4 px-5 content">
					<div style="display: flex; justify-content: space-between;">
						<h2 style="color: black; font-weight: bold;"
							th:text="${question.questionTitle}"></h2>
						<div th:if="${accountKind} == 'M'">
							<a class="btn btn-outline-success"
								th:href="@{/addQuestion(memberName=${question.memberName})}">질문하기</a>
						</div>
					</div>
					<span th:text="조회수 +' '+ ${viewsCount}"></span> <span
						th:text="작성일 +' '+ ${#strings.substring(question.questionCreateDate, 0, 16)}"></span>
					<div style="font-size: 18px; text-align: right;"
						th:text="작성자 + ' '+ ${question.memberName}"></div>
					<hr>
					<!-- 여기에 본문 넣으면댐 -->
					<div style="display: flex">
						<div style="flex-direction: row; flex-wrap: nowrap;">
							<table>
								<tr>
									<td><button class="btn" type="button" id="upBtn">
											<i id="fa-chevron-up" class='fas fa-chevron-up'
												style='font-size: 24px'></i>
										</button></td>
								</tr>
								<tr>
									<td
										style="text-align: center; font-size: 20px; font-weight: bold;"><div
											id="voteTotalCount"></div></td>
								</tr>
								<tr>
									<td><button class="btn" type="button" id="downBtn">
											<i id="fa-chevron-down" class='fas fa-chevron-down'
												style='font-size: 24px'></i>
										</button></td>
								</tr>
							</table>
						</div>
						<input type="hidden" id="questionContent"
							th:value="${question.questionContent}">
						<div
							style="display: flex; flex-direction: column; justify-content: space-between; flex-wrap: nowrap;">
							<div id="viewer"></div>
							<div>
								<span th:each="qh : ${questionHashtagList}"> <span><a
										type="button" class="tagBtn btn btn-outline-primary"
										th:href="@{getQuestionListByHashtag(hashtagName=${qh.hashtagName})}"
										th:text="${qh.hashtagName}"></a></span>
								</span>
							</div>

						</div>

					</div>

					<br>
					<div>
						<span><a class="btn btn-outline-secondary btn-sm"
							th:href="@{/getQuestionList}">목록</a></span> <span
							th:if="${memberName} == ${question.memberName}"><a
							class="btn btn-outline-warning btn-sm"
							th:href="@{/modifyQuestion(questionNo=${question.questionNo})}">수정</a></span>
						<span th:if="${memberName} != ${question.memberName}"><a
							id="reportBtn" class="btn btn-outline-danger btn-sm" href="#">신고</a></span>
					</div>

					<hr>

					<div id="questionCommentList"></div>
					<div id="questionCommentAllList"></div>
					<div id="questionCommentShowMore"></div>
					<div id="questionCommentShowMore2"></div>
					<div id="questionCommentShowReturn"></div>

					<div id="questionComment">
						<br> <a th:if="${accountKind} == 'M'"
							id="writeQuestionCommentBtn" href="#">댓글 작성</a>
					</div>
					<br>
					<!-- 답변 투표수 -->
					<h2 id="answerTotalCount"></h2>
					<hr>
					<!-- 답변 리스트 -->
					<div id="answerList"></div>
					<div id="addedAnswerList"></div>

					<!-- 답변 작성 -->
					<div
						th:if="${accountKind} == 'M' and ${question.memberName} != ${memberName}">
						<div id="editor"></div>
						<textarea rows="5" cols="100" class="form-control"
							id="addAnswerContent" placeholder="Enter your answer"></textarea>
						<br>
						<button class="btn btn-outline-success" id="addAnswerBtn">답변작성</button>
					</div>
					<div th:if="${question.memberName} == ${memberName}">질문자는 답변을
						작성할 수 없습니다.</div>
					<div th:if="${accountKind} == 'G'">
						답변을 작성하려면 <a th:href="@{/memberLogin}" th:text="로그인"></a>을 하세요.
					</div>

					<!-- 신고 팝업 -->
					<form id="reportForm" method="post"
						th:action="@{javascript:openWindowPop('popup');}"></form>

					<!-- 값을 넘기기 위한 input -->
					<input type="hidden" id="rowPerPage"> <input type="hidden"
						id="questionNo" th:value="${question.questionNo}"> <input
						type="hidden" id="memberName" th:value="${memberName}"> <input
						type="hidden" id="commentIp" th:value="${ip}">
				</div>
				<!-- /.container-fluid -->
			</div>
			<br>
			<!-- End of Main Content -->

			<!-- 하단 저작권 -->
			<footer class="sticky-footer bg-white">
				<div class="container my-auto">
					<div class="copyright text-center my-auto">
						<span>Copyright &copy; Your Website 2020</span>
					</div>
				</div>
			</footer>
			<!-- 하단 저작권 끝 -->

		</div>
		<!-- End of Content Wrapper -->

	</div>
	<!-- End of Page Wrapper -->

	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="#page-top"> <i
		class="fas fa-angle-up"></i>
	</a>
	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">로그아웃</h5>
					<button class="close" type="button" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="modal-body">정말 로그아웃 하시겠습니까?</div>
				<div class="modal-footer">
					<button class="btn btn-secondary" type="button"
						data-dismiss="modal">취소</button>
					<a class="btn btn-primary" th:href="@{/logout}">로그아웃</a>
				</div>
			</div>
		</div>
	</div>

	<!-- Bootstrap core JavaScript-->
	<script th:src="@{/vendor/jquery/jquery.min.js}"></script>
	<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

	<!-- Core plugin JavaScript-->
	<script th:src="@{/vendor/jquery-easing/jquery.easing.min.js}"></script>

	<!-- Custom scripts for all pages-->
	<script th:src="@{/js/sb-admin-2.min.js}"></script>
</body>
<script>
	$('#reportBtn').click(function(){
		$('#reportForm').submit();
		function openWindowPop(name) {
			
		}			
	});
</script>
</html>